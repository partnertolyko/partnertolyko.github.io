<!doctype html>
<html lang="ru" referrerpolicy="no-referrer">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Auth Callback</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 40px; line-height: 1.5; }
    h1 { margin: 0 0 12px; }
    .box { background: #f6f6f6; padding: 14px 16px; border-radius: 10px; margin: 16px 0; }
    code { background: #eee; padding: 2px 6px; border-radius: 6px; }
    .ok { color: #1b7f3b; }
    .err { color: #c62828; }
    .row { margin: 6px 0; }
  </style>
</head>
<body>
  <h1 id="title">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>

  <div id="panel" class="box">
    <div id="msg"></div>
  </div>

  <script>
    (function () {
      const qs = new URLSearchParams(location.search);
      const code  = qs.get("code");
      const state = qs.get("state") || "";
      const err   = qs.get("error");
      const errd  = qs.get("error_description");

      const msg = document.getElementById("msg");

      if (err) {
        document.title = "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
        msg.innerHTML = `<p class='err'>‚ùå –û—à–∏–±–∫–∞: <code>${err}</code></p><p>${errd || ""}</p>`;
        return;
      }

      if (!code) {
        document.title = "–û—à–∏–±–∫–∞";
        msg.innerHTML = "<p class='err'>‚ùå –í –æ—Ç–≤–µ—Ç–µ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ <code>code</code>.</p>";
        return;
      }

      document.title = "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞";
      msg.innerHTML = "<p class='ok'>‚úÖ –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω. –ò–¥—ë—Ç –ø–µ—Ä–µ–¥–∞—á–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...</p>";

      // üîë –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      fetch("http://localhost:8080/callback?code=" + encodeURIComponent(code) + "&state=" + encodeURIComponent(state))
        .then(() => {
          msg.innerHTML += "<p class='ok'>‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É.</p>";
        })
        .catch(() => {
          msg.innerHTML += "<p class='err'>‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–æ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ.</p>";
        });
    })();
  </script>
</body>
</html>
